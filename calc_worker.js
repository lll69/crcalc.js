/*! For license information please see calc_worker.js.LICENSE.txt */
(()=>{"use strict";const t=Math,e=t.LN2,r=t.abs,n=t.ceil,i=t.floor,s=t.log,a=t.max,u=t.random,l=t.round,o=t.sqrt,h=BigInt,c=Number;class p extends Error{constructor(t,e){super(t+(e?": "+e:e))}}class f extends p{constructor(t){super("PrecisionOverflowException",t)}}class m extends p{constructor(t){super("ArithmeticException",t)}}class g extends p{constructor(t){super("NumberFormatException",t)}}class w extends m{constructor(){super("Division by zero")}}class d extends p{constructor(t){super("AssertionError",t)}}function R(t){return t<0n?-t:t}function _(t,e){return t<e?-1:t===e?0:1}function N(t){return t<0n?-1:0n===t?0:1}function E(t){if(0n===t)return 0;t<0n&&(t=-1n-t);let e=0,r=t>>1048576n;for(;0n!==r;)e+=1048576,r=(t=r)>>1048576n;for(r=t>>1024n;0n!==r;)e+=1024,r=(t=r)>>1024n;for(r=t>>64n;0n!==r;)e+=64,r=(t=r)>>64n;let n,i=0n,s=64n;for(;i<s;)n=i+s+1n>>1n,t>>n===0n?s=n-1n:i=n;return e+c(i)+1}function C(t,e){return 0n===e?t:e<0n?t>>-e:t<<e}function F(t,e){return e>=0n?t<<e:C(t,e+1n)+1n>>1n}class v{constructor(){this.min_prec=0,this.appr_valid=!1}static bound_log2(t){let i=r(t);return 0^n(s(i+1)/e)}static check_prec(t){if(t>>28^t>>29)throw new f}static valueOfN(t){return new O(t)}setMaxAppr(t){this.max_appr=t,this.maxApprBitLen=-1}getApprBitLen(){let t=this.maxApprBitLen;return-1===t&&(t=this.max_appr>=0n?E(this.max_appr):E(-this.max_appr),this.maxApprBitLen=t),t}get_appr(t){if(v.check_prec(t),this.appr_valid&&t>=this.min_prec)return F(this.max_appr,h(this.min_prec-t));{let e=this.approximate(t);return this.min_prec=t,this.setMaxAppr(e),this.appr_valid=!0,e}}known_msd(){let t=this.getApprBitLen();return this.min_prec+t-1}msd(t){return(!this.appr_valid||this.max_appr<=1n&&this.max_appr>=-1n)&&(this.get_appr(t-1),R(this.max_appr)<=1n)?-2147483648:this.known_msd()}iter_msd(t){let e,r=0;for(;r>t+30;r=(3*r>>1)-16){if(e=this.msd(r),-2147483648!==e)return e;v.check_prec(r)}return this.msd(t)}msd_get(){return this.iter_msd(-2147483648)}static zeroes(t){let e="";for(let r=0;r<t;++r)e+="0";return e}simple_ln(){return new L(this.subtract(v.ONE))}static atan_reciprocal(t){return new V(t)}compareToRA(t,e,r){let n=this.iter_msd(r),i=t.iter_msd(n>r?n:r),s=i>n?i:n;if(-2147483648===s)return 0;v.check_prec(e);let a=s+e,u=a>r?a:r;return this.compareToA(t,u)}compareToA(t,e){let r=e-1,n=this.get_appr(r),i=t.get_appr(r);return _(n,i+1n)>0?1:_(n,i-1n)<0?-1:0}compareTo(t){for(let e=-20;;e*=2){v.check_prec(e);let r=this.compareToA(t,e);if(0!==r)return r}}signumA(t){if(this.appr_valid){let t=N(this.max_appr);if(0!==t)return t}let e=t-1;return N(this.get_appr(e))}signum(){for(let t=-20;;t*=2){v.check_prec(t);let e=this.signumA(t);if(0!==e)return e}}static valueOfS(t,e){if(void 0===e&&(e=10),2!==e&&8!==e&&10!==e&&16!==e)throw new g("Radix: "+e);let r,n,i=t.length,s=0;for(;" "===t.charAt(s);)++s;for(;" "===t.charAt(i-1);)--i;r=t.indexOf(".",s),-1===r?(r=i,n=""):n=t.substring(r+1,i);let a,u=t.substring(s,r);switch(e){case 2:a=h("0b"+u+n);break;case 8:a=h("0o"+u+n);break;case 10:a=h(u+n);break;case 16:a=h("0x"+u+n)}let l=h(e)**h(n.length);return v.valueOfN(a).divide(v.valueOfN(l))}toStringR(t,e){let r;if(16===e)r=this.shiftLeft(4*t);else{let n=h(e)**h(t);r=this.multiply(new O(n))}let n,i=r.get_appr(0),s=R(i).toString(e);if(0===t)n=s;else{let e=s.length;e<=t&&(s=v.zeroes(t+1-e)+s,e=t+1),n=s.substring(0,e-t)+"."+s.substring(e-t)}return i<0n&&(n="-"+n),n}toStringD(t){return this.toStringR(t,10)}toString(){return this.toStringD(10)}BigIntegerValue(){return this.get_appr(0)}doubleValue(){let t=this.iter_msd(-1080);if(-2147483648===t)return 0;let e=t-60,r=c(this.get_appr(e)),n=e<-1e3,i=new ArrayBuffer(8),s=new DataView(i);s.setFloat64(0,r);let a=s.getBigInt64(0),u=h(n?e+96:e);if((a>>52n&0x7ffn)+u>=2047)return r<0?-1/0:1/0;a+=u<<52n,s.setBigInt64(0,a);let l=s.getFloat64(0);if(n){const t=c(1n<<48n);return l/t/t}return l}add(t){return new x(this,t)}shiftLeft(t){return v.check_prec(t),new I(this,t)}shiftRight(t){return v.check_prec(t),new I(this,-t)}assumeInt(){return new b(this)}negate(){return new T(this)}subtract(t){return new x(this,t.negate())}multiply(t){return new A(this,t)}inverse(){return new P(this)}divide(t){return new A(this,t.inverse())}select(t,e){return new S(this,t,e)}max(t){return this.subtract(t).select(t,this)}min(t){return this.subtract(t).select(this,t)}abs(){return this.select(this.negate(),this)}exp(){let t=this.get_appr(-10);if(t>2n||t<-2n){let t=this.shiftRight(1).exp();return t.multiply(t)}return new q(this)}cos(){let t=this.divide(v.PI).get_appr(-1);if(R(t)>=2n){let e=F(t,-1n),r=v.PI.multiply(v.valueOfN(e));return 0n!==(1n&e)?this.subtract(r).cos().negate():this.subtract(r).cos()}if(R(this.get_appr(-1))>=2n){let t=this.shiftRight(1).cos();return t.multiply(t).shiftLeft(1).subtract(v.ONE)}return new D(this)}sin(){return v.half_pi.subtract(this).cos()}asin(){let t=this.get_appr(-10);return t>750n?v.ONE.subtract(this.multiply(this)).sqrt().acos():t<-750n?this.negate().asin().negate():new k(this)}acos(){return v.half_pi.subtract(this.asin())}ln(){let t=this.get_appr(-4);if(t<0n)throw new m("ln(negative)");if(t<=8n)return this.inverse().ln().negate();if(t>=24n){if(t<=64n)return this.sqrt().sqrt().ln().shiftLeft(2);{let e=E(t)-3;return this.shiftRight(e).ln().add(v.valueOfN(h(e)).multiply(v.ln2))}}return this.simple_ln()}sqrt(){return new B(this)}}class y extends v{get_appr(t){if(y.check_prec(t),this.appr_valid&&t>=this.min_prec)return F(this.max_appr,h(this.min_prec-t));{let e=t>=-64?-64:t-32+1&-32,r=this.approximate(e);return this.min_prec=e,this.setMaxAppr(r),this.appr_valid=!0,F(r,h(e-t))}}}class O extends v{constructor(t){super(),this.value=t}approximate(t){return F(this.value,h(-t))}}class b extends v{constructor(t){super(),this.value=t}approximate(t){return t>=0?this.value.get_appr(t):F(this.value.get_appr(0),h(-t))}}class x extends v{constructor(t,e){super(),this.op1=t,this.op2=e}approximate(t){return F(this.op1.get_appr(t-2)+this.op2.get_appr(t-2),-2n)}}class I extends v{constructor(t,e){super(),this.op=t,this.count=e}approximate(t){return this.op.get_appr(t-this.count)}}class T extends v{constructor(t){super(),this.op=t}approximate(t){return-this.op.get_appr(t)}negate(){return this.op}}class S extends v{constructor(t,e,r){super(),this.selector=t,this.selector_sign=N(t.get_appr(-20)),this.op1=e,this.op2=r}approximate(t){if(this.selector_sign<0)return this.op1.get_appr(t);if(this.selector_sign>0)return this.op2.get_appr(t);let e=this.op1.get_appr(t-1),r=this.op2.get_appr(t-1);return R(e-r)<=1n?F(e,-1n):this.selector.signum()<0?(this.selector_sign=-1,F(e,-1n)):(this.selector_sign=1,F(r,-1n))}}class A extends v{constructor(t,e){super(),this.op1=t,this.op2=e}approximate(t){let e,r=(t>>1)-1,n=this.op1.msd(r);if(-2147483648===n){if(e=this.op2.msd(r),-2147483648===e)return 0n;{let t;t=this.op1,this.op1=this.op2,this.op2=t,n=e}}let i=t-n-3,s=this.op2.get_appr(i);if(0n===s)return 0n;e=this.op2.known_msd();let a=t-e-3;return F(this.op1.get_appr(a)*s,h(a+i-t))}}class P extends v{constructor(t){super(),this.op=t}approximate(t){let e=this.op.msd_get(),r=e-(1-e-t+3),n=-t-r;if(n<0)return 0n;let i=1n<<h(n),s=this.op.get_appr(r),a=R(s),u=(i+(a>>1n))/a;return s<0?-u:u}}class q extends v{constructor(t){super(),this.op=t}approximate(t){if(t>=1)return 0n;let e=2+(-t>>1),r=t-q.bound_log2(2*e)-4,n=t-3,i=this.op.get_appr(n),s=h(n),a=1n<<h(-r),u=a,l=a,o=0,c=1n<<h(t-4-r);for(;R(u)>=c;)o=o+1^0,u=F(u*i,s),u/=h(o),l+=u;return F(l,h(r-t))}}class D extends y{constructor(t){super(),this.op=t}approximate(t){if(t>=1)return 0n;let e,r,n=4+(-t>>1),i=t-D.bound_log2(2*n)-4,s=t-2,a=this.op.get_appr(s),u=h(s),l=1n<<h(t-4-i);r=0,e=1n<<h(-i);let o=e;for(;R(e)>=l;)r+=2,e=F(e*a,u),e=F(e*a,u),e/=h(-r)*h(r-1),o+=e;return F(o,h(i-t))}}class V extends y{constructor(t){super(),this.op=t}approximate(t){if(t>=1)return 0n;let e=2+(-t>>1),r=t-V.bound_log2(2*e)-2,n=1n<<h(-r),i=h(this.op),s=h(this.op*this.op),a=n/i,u=a,l=a,o=a,c=1,p=1,f=1n<<h(t-2-r);for(;R(l)>=f;)p+=2,u/=s,c=-c,l=u/h(c*p),o+=l;return F(o,h(r-t))}}class L extends y{constructor(t){super(),this.op=t}approximate(t){if(t>=0)return 0n;let e=-t,r=t-L.bound_log2(2*e)-4,n=t-3,i=this.op.get_appr(n),s=h(n),a=F(i,h(n-r)),u=a,l=u,o=1,c=1,p=1n<<h(t-4-r);for(;R(u)>=p;)o+=1,c=-c,a=F(a*i,s),u=a/h(o*c),l+=u;return F(l,h(r-t))}}class k extends y{constructor(t){super(),this.op=t}approximate(t){if(t>=2)return 0n;let e=-3*(t>>1)+4,r=t-k.bound_log2(2*e)-4,n=t-3,i=this.op.get_appr(n),s=h(n+2),a=h(n-2),u=1n<<h(t-4-r),l=1,o=i<<h(n-r),c=o,p=o;for(;R(o)>=u;)l+=2,p*=h(l-2),p=F(p*i,s),p*=i,p/=h(l-1),p=F(p,a),o=p/h(l),c+=o;return F(c,h(r-t))}}class B extends v{constructor(t,e=0,r=null){super(),this.op=t,this.min_prec=e,null!==r&&(this.setMaxAppr(r),this.appr_valid=!0)}approximate(t){let e=(t<<1)-1,r=this.op.iter_msd(e);if(r<=e)return 0n;let n=r>>1,s=n-t;if(s>50){let e=n-(6+(s>>1)),r=e<<1,i=this.op.get_appr(r),a=this.get_appr(e);return F(a*a+i,h(e-t))/a+1n>>1n}{let e=r-60&-2,n=e-60,s=this.op.get_appr(e)<<60n,a=c(s);if(a<0)throw new m("sqrt(negative)");let u=o(a);return C(h(i(u)),h((n>>1)-t))}}}class M extends y{constructor(){super(),this.b_prec=[null],this.b_val=[null]}approximate(t){if(this.b_prec.length>this.b_val.length&&this.b_prec.pop(),t>=0)return F(3n,h(-t));const r=n(s(-t)/e)+10^0,i=h(-r),a=t-r,u=h(-a);let l=1n<<u,o=M.SQRT_HALF.get_appr(a),c=1n<<h(-a-2),p=0;for(;l-o-4n>0n;){let e,r=l+o>>1n,n=l-r,s=l*o>>u,f=M.valueOfN(s).shiftRight(-a);if(this.b_prec.length===p+1){e=f.sqrt().get_appr(a);let r=F(e,i);this.b_prec.push(t),this.b_val.push(r)}else e=new B(f,this.b_prec[p+1],this.b_val[p+1]).get_appr(a),this.b_prec[p+1]=t,this.b_val[p+1]=F(e,i);l=r,o=e,c-=n*n<<h(p+a),++p}let f=l+o;return F(f*f/c>>2n,i)}}v.ZERO=v.valueOfN(0n),v.ONE=v.valueOfN(1n),v.ten_ninths=v.valueOfN(10n).divide(v.valueOfN(9n)),v.twentyfive_twentyfourths=v.valueOfN(25n).divide(v.valueOfN(24n)),v.eightyone_eightyeths=v.valueOfN(81n).divide(v.valueOfN(80n)),v.ln2_1=v.valueOfN(7n).multiply(v.ten_ninths.simple_ln()),v.ln2_2=v.valueOfN(2n).multiply(v.twentyfive_twentyfourths.simple_ln()),v.ln2_3=v.valueOfN(3n).multiply(v.eightyone_eightyeths.simple_ln()),v.ln2=v.ln2_1.subtract(v.ln2_2).add(v.ln2_3),v.SQRT_HALF=new B(v.ONE.shiftRight(1)),v.four=v.valueOfN(4n),v.PI=new M,v.atan_PI=v.four.multiply(v.four.multiply(v.atan_reciprocal(5)).subtract(v.atan_reciprocal(239))),v.half_pi=v.PI.shiftRight(1);class H{}const Z=Object.freeze({sinFunction:new class extends H{execute(t){return t.sin()}},cosFunction:new class extends H{execute(t){return t.cos()}},tanFunction:new class extends H{execute(t){return t.sin().divide(t.cos())}},asinFunction:new class extends H{execute(t){return t.asin()}},acosFunction:new class extends H{execute(t){return t.acos()}},atanFunction:new class extends H{constructor(){super(...arguments),this.one=v.ONE}execute(t){let e=t.multiply(t),r=e.divide(this.one.add(e)).sqrt();return t.select(r.negate(),r).asin()}}});class Q{constructor(t,e=1n){this.mNum=t,this.mDen=e}static valueOfS(t,e){if(void 0===e&&(e=10),2!==e&&8!==e&&10!==e&&16!==e)throw new g("Radix: "+e);let r,n,i=t.length,s=0;for(;" "===t.charAt(s);)++s;for(;" "===t.charAt(i-1);)--i;r=t.indexOf(".",s),-1===r?(r=i,n=""):n=t.substring(r+1,i);let a,u=t.substring(s,r);switch(e){case 2:a=h("0b"+u+n);break;case 8:a=h("0o"+u+n);break;case 10:a=h(u+n);break;case 16:a=h("0x"+u+n)}let l=h(e)**h(n.length);return new Q(a,l)}toString(){return this.mNum.toString()+"/"+this.mDen.toString()}toNiceString(){let t=this.reduce().positiveDen(),e=t.mNum.toString();return 1n!==t.mDen&&(e+="/"+t.mDen),e}static toString(t){return null===t?"not a small rational":t.toString()}toStringTruncated(t){let e=(R(this.mNum)*10n**h(t)/R(this.mDen)).toString(),r=e.length;return r<t+1&&(e="0".repeat(t+1-r)+e,r=t+1),(this.signum()<0?"-":"")+e.substring(0,r-t)+"."+e.substring(r-t)}crValue(){return v.valueOfN(this.mNum).divide(v.valueOfN(this.mDen))}intValue(){let t=this.reduce();if(1n!==t.mDen)throw new m("intValue of non-int");return c(t.mNum)}wholeNumberBits(){return 0n===this.mNum?-2147483648:E(this.mNum)-E(this.mDen)}tooBig(){return 1n!==this.mDen&&E(this.mNum)+E(this.mDen)>1e4}positiveDen(){return this.mDen>0n?this:new Q(-this.mNum,-this.mDen)}reduce(){if(1n===this.mDen)return this;let t=function(t,e){let r;for(t=t<0n?-t:t,e=e<0n?-e:e;0n!==e;)r=e,e=t%e,t=r;return t}(this.mNum,this.mDen);return new Q(this.mNum/t,this.mDen/t)}static maybeReduce(t){if(null===t)return null;if(!t.tooBig()&&u()<1/16)return t;let e=t.positiveDen();return e=e.reduce(),e.tooBig()?null:e}compareTo(t){return _(this.mNum*t.mDen,t.mNum*this.mDen)*N(this.mDen)*N(t.mDen)}signum(){return N(this.mNum)*N(this.mDen)}equals(t){return null!==t&&0===this.compareTo(t)}static asBigInteger(t){return null===t?null:t.mNum%t.mDen===0n?t.mNum/t.mDen:null}static add(t,e){if(null===t||null===e)return null;let r=t.mDen*e.mDen,n=t.mNum*e.mDen+e.mNum*t.mDen;return Q.maybeReduce(new Q(n,r))}static negate(t){return null===t?null:new Q(-t.mNum,t.mDen)}static subtract(t,e){return Q.add(t,Q.negate(e))}static rawMultiply(t,e){if(null===t||null===e)return null;if(t===Q.ONE)return e;if(e===Q.ONE)return t;let r=t.mNum*e.mNum,n=t.mDen*e.mDen;return new Q(r,n)}static multiply(t,e){return Q.maybeReduce(Q.rawMultiply(t,e))}static inverse(t){if(null===t)return null;if(0n===t.mNum)throw new w;return new Q(t.mDen,t.mNum)}static divide(t,e){return Q.multiply(t,Q.inverse(e))}static sqrt(t){if(null===t)return null;if((t=t.positiveDen().reduce()).mNum<0n)throw new m("sqrt(negative)");let e=l(o(c(t.mNum)));if(e===1/0)return null;let r=h(e);if(r*r!==t.mNum)return null;let n=l(o(c(t.mDen)));if(n===1/0)return null;let i=h(n);return i*i!==t.mDen?null:new Q(r,i)}rawPow(t){if(1n===t)return this;if(1n===(1n&t))return Q.rawMultiply(this.rawPow(t-1n),this);if(0n===t)return Q.ONE;let e=this.rawPow(t>>1n),r=Q.rawMultiply(e,e);return null===r||r.tooBig()?null:r}pow(t){let e=N(t);if(0===e)return Q.ONE;if(1n===t)return this;let r=this.reduce().positiveDen();if(1n===r.mDen){if(0n===r.mNum)return Q.ZERO;if(1n===r.mNum)return Q.ONE;if(-1n===r.mNum)return 1n===(1n&t)?Q.MINUS_ONE:Q.ONE}return E(t)>1e3?null:e<0?Q.inverse(r).rawPow(-t):r.rawPow(t)}static pow(t,e){return null===e||null===t||1n!==(e=e.reduce().positiveDen()).mDen?null:t.pow(e.mNum)}static digitsRequired(t){if(null===t)return 2147483647;let e=0,r=0;if(1n===t.mDen)return 0;let n=(t=t.reduce()).mDen;if(E(n)>1e4)return 2147483647;for(;0n===(1n&n);)++e,n>>=1n;for(;n%5n===0n;)++r,n/=5n;return 1n!==n&&-1n!==n?1e4:a(e,r)}}Q.ZERO=new Q(0n),Q.HALF=new Q(1n,2n),Q.MINUS_HALF=new Q(-1n,2n),Q.THIRD=new Q(1n,3n),Q.QUARTER=new Q(1n,4n),Q.SIXTH=new Q(1n,6n),Q.ONE=new Q(1n),Q.MINUS_ONE=new Q(-1n),Q.TWO=new Q(2n),Q.MINUS_TWO=new Q(-2n),Q.TEN=new Q(10n),Q.TWELVE=new Q(12n);const U=1n<<1000n;class z{static check(t){if(!t)throw new d}constructor(t,e){if(null===t)throw new m("Building UnifiedReal from null");this.mCrFactor=e,this.mRatFactor=t}static newCR(t){return new z(Q.ONE,t)}static newBR(t){return new z(t,z.CR_ONE)}static newN(t){return z.newBR(new Q(t))}static getSquare(t){const e=z.sSqrts;for(let r=0;r<e.length;++r)if(e[r]===t)return new Q(h(r));return null}getExp(t){const e=z.sLogs;for(let r=0;r<e.length;++r)if(e[r]===t)return new Q(h(r));return null}static crName(t){if(t===z.CR_ONE)return"";if(t===z.CR_PI)return"π";if(t===z.CR_E)return"e";const e=z.sSqrts;for(let r=0;r<e.length;++r)if(t===e[r])return"√"+r;const r=z.sLogs;for(let e=0;e<r.length;++e)if(t===r[e])return"ln("+e+")";return null}static isNamed(t){if(t===z.CR_ONE||t===z.CR_PI||t===z.CR_E)return!0;const e=z.sSqrts;for(let r=0;r<e.length;++r)if(t===e[r])return!0;const r=z.sLogs;for(let e=0;e<r.length;++e)if(t===r[e])return!0;return!1}static definitelyAlgebraic(t){return t===z.CR_ONE||null!==z.getSquare(t)}definitelyRational(){return this.mCrFactor===z.CR_ONE||0===this.mRatFactor.signum()}definitelyIrrational(){return!this.definitelyRational()&&z.isNamed(this.mCrFactor)}definitelyAlgebraic(){return z.definitelyAlgebraic(this.mCrFactor)||0===this.mRatFactor.signum()}definitelyTranscendental(){return!this.definitelyAlgebraic()&&z.isNamed(this.mCrFactor)}static definitelyIndependent(t,e){return t!==e&&(t===z.CR_E||t===z.CR_PI?z.definitelyAlgebraic(e):e===z.CR_E||e===z.CR_PI?z.definitelyAlgebraic(t):z.isNamed(t)&&z.isNamed(e))}toString(){return this.mRatFactor.toString()+"*"+this.mCrFactor.toString()}toNiceString(){if(this.mCrFactor===z.CR_ONE||0===this.mRatFactor.signum())return this.mRatFactor.toNiceString();let t=z.crName(this.mCrFactor);if(null!==t){let e=Q.asBigInteger(this.mRatFactor);return null!==e?1n===e?t:this.mRatFactor.toNiceString()+t:"("+this.mRatFactor.toNiceString()+")"+t}return this.mRatFactor===Q.ONE?this.mCrFactor.toString():this.crValue().toString()}exactlyDisplayable(){return null!==z.crName(this.mCrFactor)}toStringTruncated(t){if(this.mCrFactor===z.CR_ONE||this.mRatFactor===Q.ZERO)return this.mRatFactor.toStringTruncated(t);const e=v.valueOfN(10n**h(t)).multiply(this.crValue());let r,n=!1;this.exactlyTruncatable()?(r=e.get_appr(0),r<0n&&(n=!0,r=-r),v.valueOfN(r).compareTo(e.abs())>0&&(r-=1n),z.check(v.valueOfN(r).compareTo(e.abs())<0)):(r=e.get_appr(-z.EXTRA_PREC),r<0n&&(n=!0,r=-r),r>>=z.EXTRA_PREC_BIG);let i=r.toString(),s=i.length;return s<t+1&&(i="0".repeat(t+1-s)+i,s=t+1),(n?"-":"")+i.substring(0,s-t)+"."+i.substring(s-t)}exactlyTruncatable(){return this.mCrFactor===z.CR_ONE||this.mRatFactor===Q.ZERO||this.definitelyIrrational()}crValue(){return this.mRatFactor.crValue().multiply(this.mCrFactor)}isComparable(t){return this.mCrFactor===t.mCrFactor&&(z.isNamed(this.mCrFactor)||0!==this.mCrFactor.signumA(-1e3))||0===this.mRatFactor.signum()&&0===t.mRatFactor.signum()||z.definitelyIndependent(this.mCrFactor,t.mCrFactor)||0!==this.crValue().compareToA(t.crValue(),-1e3)}compareTo(t){return this.definitelyZero()&&t.definitelyZero()?0:this.mCrFactor===t.mCrFactor?this.mCrFactor.signum()*this.mRatFactor.compareTo(t.mRatFactor):this.crValue().compareTo(t.crValue())}compareToA(t,e){return this.isComparable(t)?this.compareTo(t):this.crValue().compareToA(t.crValue(),e)}signumA(t){return this.compareToA(z.ZERO,t)}signum(){return this.compareTo(z.ZERO)}approxEquals(t,e){return this.isComparable(t)?(!z.definitelyIndependent(this.mCrFactor,t.mCrFactor)||0===this.mRatFactor.signum()&&0===t.mRatFactor.signum())&&0===this.compareTo(t):0===this.crValue().compareToA(t.crValue(),e)}definitelyEquals(t){return this.isComparable(t)&&0===this.compareTo(t)}definitelyNotEquals(t){let e=z.isNamed(this.mCrFactor),r=z.isNamed(t.mCrFactor);return e&&r?z.definitelyIndependent(this.mCrFactor,t.mCrFactor)?0!==this.mRatFactor.signum()||0!==t.mRatFactor.signum():(this.mCrFactor,t.mCrFactor,!this.mRatFactor.equals(t.mRatFactor)):0===this.mRatFactor.signum()?r&&0!==t.mRatFactor.signum():0===t.mRatFactor.signum()&&e&&0!==this.mRatFactor.signum()}definitelyZero(){return 0===this.mRatFactor.signum()}definitelyNonZero(){return z.isNamed(this.mCrFactor)&&0!==this.mRatFactor.signum()}definitelyOne(){return this.mCrFactor===z.CR_ONE&&this.mRatFactor.equals(Q.ONE)}boundedRationalValue(){return this.mCrFactor===z.CR_ONE||0===this.mRatFactor.signum()?this.mRatFactor:null}bigIntegerValue(){let t=this.boundedRationalValue();return Q.asBigInteger(t)}add(t){if(this.mCrFactor===t.mCrFactor){let e=Q.add(this.mRatFactor,t.mRatFactor);if(null!==e)return new z(e,this.mCrFactor)}return this.definitelyZero()?t:t.definitelyZero()?this:z.newCR(this.crValue().add(t.crValue()))}negate(){return new z(Q.negate(this.mRatFactor),this.mCrFactor)}subtract(t){return this.add(t.negate())}multiply(t){if(this.mCrFactor===z.CR_ONE){let e=Q.multiply(this.mRatFactor,t.mRatFactor);if(null!==e)return new z(e,t.mCrFactor)}if(t.mCrFactor===z.CR_ONE){let e=Q.multiply(this.mRatFactor,t.mRatFactor);if(null!==e)return new z(e,this.mCrFactor)}if(this.definitelyZero()||t.definitelyZero())return z.ZERO;if(this.mCrFactor===t.mCrFactor){let e=z.getSquare(this.mCrFactor);if(null!==e){let r=Q.multiply(Q.multiply(e,this.mRatFactor),t.mRatFactor);if(null!==r)return z.newBR(r)}}let e=Q.multiply(this.mRatFactor,t.mRatFactor);return null!==e?new z(e,this.mCrFactor.multiply(t.mCrFactor)):z.newCR(this.crValue().multiply(t.crValue()))}inverse(){if(this.definitelyZero())throw new w;let t=z.getSquare(this.mCrFactor);if(null!==t){let e=Q.inverse(Q.multiply(this.mRatFactor,t));if(null!==e)return new z(e,this.mCrFactor)}return new z(Q.inverse(this.mRatFactor),this.mCrFactor.inverse())}divide(t){if(this.mCrFactor===t.mCrFactor){if(t.definitelyZero())throw new w;let e=Q.divide(this.mRatFactor,t.mRatFactor);if(null!==e)return new z(e,z.CR_ONE)}return this.multiply(t.inverse())}sqrt(){if(this.definitelyZero())return z.ZERO;if(this.mCrFactor===z.CR_ONE){let t;for(let e=1;e<z.sSqrts.length;++e)if(null!==z.sSqrts[e]&&(t=Q.sqrt(Q.divide(this.mRatFactor,new Q(h(e)))),null!==t))return new z(t,z.sSqrts[e])}return z.newCR(this.crValue().sqrt())}getPiTwelfths(){if(this.definitelyZero())return 0n;if(this.mCrFactor===z.CR_PI){let t=Q.asBigInteger(Q.multiply(this.mRatFactor,Q.TWELVE));return null===t?null:t%24n}return null}static sinPiTwelfths(t){if(t>=12){let e=z.sinPiTwelfths(t-12);return null===e?null:e.negate()}switch(t){case 0:return z.ZERO;case 2:case 10:return z.HALF;case 3:case 9:return z.HALF_SQRT2;case 4:case 8:return z.HALF_SQRT3;case 6:return z.ONE;default:return null}}sin(){let t=this.getPiTwelfths();if(null!==t){let e=z.sinPiTwelfths(c(t));if(null!==e)return e}return z.newCR(this.crValue().sin())}static cosPiTwelfths(t){let e=t+6;return e>=24&&(e-=24),z.sinPiTwelfths(e)}cos(){let t=this.getPiTwelfths();if(null!==t){let e=z.cosPiTwelfths(c(t));if(null!==e)return e}return z.newCR(this.crValue().cos())}tan(){let t=this.getPiTwelfths();if(null!==t){let e=c(t);if(6===e||18===e)throw new m("Tangent undefined");let r=z.sinPiTwelfths(e),n=z.cosPiTwelfths(e);if(null!==r&&null!==n)return r.divide(n)}return this.sin().divide(this.cos())}checkAsinDomain(){if(this.isComparable(z.ONE)&&(this.compareTo(z.ONE)>0||this.compareTo(z.MINUS_ONE)<0))throw new m("inverse trig argument out of range")}static asinHalves(t){if(t<0)return this.asinHalves(-t).negate();switch(t){case 0:return z.ZERO;case 1:return new z(Q.SIXTH,v.PI);case 2:return new z(Q.HALF,v.PI)}throw new d("asinHalves: Bad argument")}asinNonHalves(){return this.compareToA(z.ZERO,-10)<0?this.negate().asinNonHalves().negate():this.definitelyEquals(z.HALF_SQRT2)?new z(Q.QUARTER,z.CR_PI):this.definitelyEquals(z.HALF_SQRT3)?new z(Q.THIRD,z.CR_PI):z.newCR(this.crValue().asin())}asin(){this.checkAsinDomain();const t=this.multiply(z.TWO).bigIntegerValue();return null!==t?z.asinHalves(c(t)):this.mCrFactor===v.ONE||this.mCrFactor!==z.CR_SQRT2||this.mCrFactor!==z.CR_SQRT3?this.asinNonHalves():z.newCR(this.crValue().asin())}acos(){return z.PI_OVER_2.subtract(this.asin())}atan(){if(this.compareToA(z.ZERO,-10)<0)return this.negate().atan().negate();const t=this.bigIntegerValue();if(null!==t&&t<=1n)switch(c(t)){case 0:return z.ZERO;case 1:return z.PI_OVER_4;default:throw new d("Impossible r_int")}return this.definitelyEquals(z.THIRD_SQRT3)?z.PI_OVER_6:this.definitelyEquals(z.SQRT3)?z.PI_OVER_3:z.newCR(Z.atanFunction.execute(this.crValue()))}static recursivePow(t,e){if(1n===e)return t;if(0n!==(1n&e))return t.multiply(z.recursivePow(t,e-1n));let r=z.recursivePow(t,e>>1n);return r.multiply(r)}expLnPow(t){let e=this.signumA(-1e3);if(e>0)return z.newCR(this.crValue().ln().multiply(v.valueOfN(t)).exp());if(e<0){let e=this.crValue().negate().ln().multiply(v.valueOfN(t)).exp();return 0n!==(1n&t)&&(e=e.negate()),z.newCR(e)}return t<0n?z.newCR(z.recursivePow(this.crValue(),-t).inverse()):z.newCR(z.recursivePow(this.crValue(),t))}powN(t){if(1n===t)return this;if(0n===t)return z.ONE;let e=R(t);if(this.mCrFactor===z.CR_ONE&&e<=U){const e=this.mRatFactor.pow(t);if(null!==e)return z.newBR(e)}if(e>1000n)return this.expLnPow(t);let r=z.getSquare(this.mCrFactor);if(null!==r){const e=Q.multiply(this.mRatFactor.pow(t),r.pow(t>>1n));if(null!==e)return 1n===(1n&t)?new z(e,this.mCrFactor):z.newBR(e)}return this.expLnPow(t)}pow(t){if(this.mCrFactor===z.CR_E){if(this.mRatFactor.equals(Q.ONE))return t.exp();{let e=z.newBR(this.mRatFactor).pow(t);return t.exp().multiply(e)}}const e=t.boundedRationalValue();if(null!==e){let t=Q.asBigInteger(e);if(null!==t)return this.powN(t);if(t=Q.asBigInteger(Q.multiply(Q.TWO,e)),null!==t)return this.powN(t).sqrt()}if(this.definitelyZero())return z.ZERO;if(this.signumA(-1e3)<0)throw new m("Negative base for pow() with non-integer exponent");return z.newCR(this.crValue().ln().multiply(t.crValue()).exp())}static pow16(t){if(t>10)throw new d("Unexpected pow16 argument");let e=h(t);return e*=e,e*=e,e*=e,e*=e,e}static getIntLog(t,e){let n=c(t),i=s(n)/s(e);if(isFinite(n)&&r(i-l(i))>1e-6)return 0n;let a=0n,u=h(e),o=null;for(;t%u===0n;)for(t/=u,++a,null===o&&(o=z.pow16(e));t%o===0n;)t/=o,a+=16n;return 1n===t?a:0n}ln(){if(this.mCrFactor===z.CR_E)return new z(this.mRatFactor,z.CR_ONE).ln().add(z.ONE);if(this.isComparable(z.ZERO)){if(this.signum()<=0)throw new m("log(non-positive)");let t=this.compareToA(z.ONE,-1e3);if(0===t){if(this.definitelyEquals(z.ONE))return z.ZERO}else if(t<0)return this.inverse().ln().negate();const e=Q.asBigInteger(this.mRatFactor);if(null!==e)if(this.mCrFactor===z.CR_ONE){const t=z.sLogs;for(let r=0;r<t.length;++r)if(null!==t[r]){let n=z.getIntLog(e,r);if(0n!==n)return new z(new Q(n),t[r])}}else{let t=z.getSquare(this.mCrFactor);if(null!==t){let r=t.intValue();const n=z.sLogs;if(null!==n[r]){let t=z.getIntLog(e,r);if(0n!==t){let e=Q.add(new Q(t),Q.HALF);if(null!==e)return new z(e,n[r])}}}}}return z.newCR(this.crValue().ln())}exp(){if(this.definitelyEquals(z.ZERO))return z.ONE;if(this.definitelyEquals(z.ONE))return z.E;const t=this.getExp(this.mCrFactor);if(null!==t){let e=!1,r=this.mRatFactor;null===Q.asBigInteger(r)&&(e=!0,r=Q.multiply(r,Q.TWO));let n=Q.pow(t,r);if(null!==n){let t=z.newBR(n);return e&&(t=t.sqrt()),t}}return z.newCR(this.crValue().exp())}static genFactorial(t,e){if(t>4n*e)return z.genFactorial(t,2n*e)*z.genFactorial(t-e,2n*e);{if(0n===t)return 1n;let r=t;for(let n=t-e;n>1n;n-=e)r*=n;return r}}fact(){let t=this.bigIntegerValue();if(null===t&&(t=this.crValue().get_appr(0),!this.approxEquals(z.newN(t),-1e3)))throw new m("Non-integral factorial argument");if(t<0n)throw new m("Negative factorial argument");if(E(t)>20)throw new m("Factorial argument too big");let e=z.genFactorial(t,1n),r=new Q(e);return z.newBR(r)}digitsRequired(){return this.mCrFactor===z.CR_ONE||0===this.mRatFactor.signum()?Q.digitsRequired(this.mRatFactor):2147483647}leadingBinaryZeroes(){if(z.isNamed(this.mCrFactor)){const t=this.mRatFactor.wholeNumberBits();return-2147483648===t?2147483647:t>=3?0:3-t}return 2147483647}approxWholeNumberBitsGreaterThan(t){return z.isNamed(this.mCrFactor)?this.mRatFactor.wholeNumberBits()>t:E(this.crValue().get_appr(t-2))>2}}z.CR_ONE=v.ONE,z.CR_PI=v.PI,z.CR_E=v.ONE.exp(),z.CR_SQRT2=v.valueOfN(2n).sqrt(),z.CR_SQRT3=v.valueOfN(3n).sqrt(),z.CR_LN2=v.valueOfN(2n).ln(),z.CR_LN3=v.valueOfN(3n).ln(),z.CR_LN5=v.valueOfN(5n).ln(),z.CR_LN6=v.valueOfN(6n).ln(),z.CR_LN7=v.valueOfN(7n).ln(),z.CR_LN10=v.valueOfN(10n).ln(),z.sSqrts=Object.freeze([null,v.ONE,z.CR_SQRT2,z.CR_SQRT3,null,v.valueOfN(5n).sqrt(),v.valueOfN(6n).sqrt(),v.valueOfN(7n).sqrt(),null,null,v.valueOfN(10n).sqrt()]),z.sLogs=Object.freeze([null,null,z.CR_LN2,z.CR_LN3,null,z.CR_LN5,z.CR_LN6,z.CR_LN7,null,null,z.CR_LN10]),z.PI=z.newCR(z.CR_PI),z.E=z.newCR(z.CR_E),z.ZERO=z.newBR(Q.ZERO),z.ONE=z.newBR(Q.ONE),z.MINUS_ONE=z.newBR(Q.MINUS_ONE),z.TWO=z.newBR(Q.TWO),z.MINUS_TWO=z.newBR(Q.MINUS_TWO),z.HALF=z.newBR(Q.HALF),z.MINUS_HALF=z.newBR(Q.MINUS_HALF),z.TEN=z.newBR(Q.TEN),z.RADIANS_PER_DEGREE=new z(new Q(1n,180n),z.CR_PI),z.SIX=z.newN(6n),z.HALF_SQRT2=new z(Q.HALF,z.CR_SQRT2),z.SQRT3=z.newCR(z.CR_SQRT3),z.HALF_SQRT3=new z(Q.HALF,z.CR_SQRT3),z.THIRD_SQRT3=new z(Q.THIRD,z.CR_SQRT3),z.PI_OVER_2=new z(Q.HALF,z.CR_PI),z.PI_OVER_3=new z(Q.THIRD,z.CR_PI),z.PI_OVER_4=new z(Q.QUARTER,z.CR_PI),z.PI_OVER_6=new z(Q.SIXTH,z.CR_PI),z.EXTRA_PREC=10,z.EXTRA_PREC_BIG=10n;const W={},j=z.E,X=z.TEN.ln(),G=z.RADIANS_PER_DEGREE,J=new Map,K=new Map,Y=new Map,$=new Map,tt=new Map,et=new Map,rt=new Map,nt=new Map,it=new Map,st=new Map,at=new Map,ut=new Map,lt=new Map,ot=new Map,ht=new Map,ct=new Map,pt=Object.freeze,ft=postMessage;function mt(t){let e=J.get(t);return void 0===e&&(e=z.newBR(Q.valueOfS(t)),J.set(t,e)),e}function gt(t){let e=J.get(t);return void 0===e&&(e=z.newN(t),J.set(t,e)),e}function wt(t){let e=K.get(t);return void 0===e&&(e=t.negate(),K.set(t,e),K.set(e,t)),e}function dt(t){let e=Y.get(t);return void 0===e&&(e=t.fact(),Y.set(t,e)),e}function Rt(t){let e=$.get(t);return void 0===e&&(e=t.sqrt(),$.set(t,e)),e}function _t(t){let e=tt.get(t);return void 0===e&&(e=t.ln(),tt.set(t,e)),e}function Nt(t){let e=et.get(t);return void 0===e&&(e=t.sin(),et.set(t,e)),e}function Et(t){let e=rt.get(t);return void 0===e&&(e=t.cos(),rt.set(t,e)),e}function Ct(t){let e=nt.get(t);return void 0===e&&(e=t.tan(),nt.set(t,e)),e}function Ft(t){let e=it.get(t);return void 0===e&&(e=t.asin(),it.set(t,e)),e}function vt(t){let e=st.get(t);return void 0===e&&(e=t.acos(),st.set(t,e)),e}function yt(t){let e=at.get(t);return void 0===e&&(e=t.atan(),at.set(t,e)),e}function Ot(t,e){let r=t.get(e);return void 0===r&&(r=new Map,t.set(e,r)),r}function bt(t,e){const r=Ot(ut,t);let n=r.get(e);return void 0===n&&(n=t.add(e),r.set(e,n),Ot(ut,e).set(t,n)),n}function xt(t,e){const r=Ot(lt,t);let n=r.get(e);return void 0===n&&(n=t.multiply(e),r.set(e,n),Ot(lt,e).set(t,n)),n}function It(t,e){const r=Ot(ot,t);let n=r.get(e);return void 0===n&&(n=t.divide(e),r.set(e,n)),n}function Tt(t,e){const r=Ot(ht,t);let n=r.get(e);return void 0===n&&(n=t**e,r.set(e,n)),n}function St(t,e){const r=Ot(ct,t);let n=r.get(e);return void 0===n&&(n=t===j?e.exp():t.pow(e),r.set(e,n)),n}function At(t){if(0===t.digitsRequired()){let e=t.bigIntegerValue();return null!==e||(e=t.crValue().get_appr(0),t.approxEquals(z.newN(e),-1e3))?e:null}return null}onmessage=function(t){const e=t.data;switch(e.type){case"createUR":try{let t=function(t,e){const r=pt(new Set(["unary+","unary-","unary+pow","unary-pow","!"])),n=pt(new Set(["+","-","*","/","^"])),i=pt(new Set(["ln","log","exp","sqrt","sin","cos","tan","asin","acos","atan","arcsin","arccos","arctan"])),s=function(t){const e=[],r=[];let n,i,s=t.length,a="\0",u="",l=0;for(n=0;n<s;a=i,n++)if(i=t[n],i>="0"&&i<="9")if("\0"===a||"."===a||a>="0"&&a<="9")u+=i;else if("!"===a||")"===a||"π"===a||a>="a"&&a<="z")e.push(u),e.push("*"),r.push(pt([n-u.length,n])),r.push(pt([n,n])),u=i;else{if("("!==a&&"^"!==a&&"+"!==a&&"-"!==a&&"*"!==a&&"/"!==a&&"×"!==a&&"÷"!==a)throw new Error("Invalid lastChar '"+a+"' at position ("+n+")");u=i}else if(i>="a"&&i<="z"||"π"===i)if("\0"===a||"π"===a||a>="a"&&a<="z")u+=i;else if("!"===a||")"===a||"."===a||a>="0"&&a<="9")e.push(u),e.push("*"),r.push(pt([n-u.length,n])),r.push(pt([n,n])),u=i;else{if("("!==a&&"^"!==a&&"+"!==a&&"-"!==a&&"*"!==a&&"/"!==a&&"×"!==a&&"÷"!==a)throw new Error("Invalid lastChar '"+a+"' at position ("+n+")");u=i}else if("."===i)if("\0"===a||a>="0"&&a<="9"){if(u.indexOf(".")>=0)throw new Error("Invalid char '.' at position ("+n+")");u+="."}else if("!"===a||")"===a||"π"===a||a>="a"&&a<="z")e.push(u),e.push("*"),r.push(pt([n-u.length,n])),r.push(pt([n,n])),u=".";else{if("("!==a&&"^"!==a&&"+"!==a&&"-"!==a&&"*"!==a&&"/"!==a&&"×"!==a&&"÷"!==a)throw"."===a?new Error("Invalid char '.' at position ("+n+")"):new Error("Invalid lastChar '"+a+"' at position ("+n+")");u="."}else if("+"===i||"-"===i)if("."===a||"!"===a||")"===a||"π"===a||a>="a"&&a<="z"||a>="0"&&a<="9")e.push(u),e.push(i),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u="";else{if("\0"!==a&&"("!==a&&"^"!==a&&"+"!==a&&"-"!==a&&"*"!==a&&"/"!==a&&"×"!==a&&"÷"!==a)throw new Error("Invalid lastChar '"+a+"' at position ("+n+")");if("^"===a||"+"===a||"-"===a)throw new Error("Missing '(' before '"+i+"' at position ("+n+")");e.push("^"===a?"unary"+i+"pow":"unary"+i),r.push(pt([n,n+1])),u=""}else if("*"===i||"×"===i){if(!("."===a||"!"===a||")"===a||"π"===a||a>="a"&&a<="z"||a>="0"&&a<="9"))throw"\0"===a||"("===a||"^"===a||"+"===a||"-"===a||"*"===a||"/"===a||"×"===a||"÷"===a?new Error("Invalid char '"+i+"' at position ("+n+")"):new Error("Invalid lastChar '"+a+"' at position ("+n+")");e.push(u),e.push("*"),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u=""}else if("/"===i||"÷"===i){if(!("."===a||"!"===a||")"===a||"π"===a||a>="a"&&a<="z"||a>="0"&&a<="9"))throw"\0"===a||"("===a||"^"===a||"+"===a||"-"===a||"*"===a||"/"===a||"×"===a||"÷"===a?new Error("Invalid char '"+i+"' at position ("+n+")"):new Error("Invalid lastChar '"+a+"' at position ("+n+")");e.push(u),e.push("/"),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u=""}else if("^"===i){if(!("."===a||"!"===a||")"===a||"π"===a||a>="a"&&a<="z"||a>="0"&&a<="9"))throw"\0"===a||"("===a||"^"===a||"+"===a||"-"===a||"*"===a||"/"===a||"×"===a||"÷"===a?new Error("Invalid char '^' at position ("+n+")"):new Error("Invalid lastChar '"+a+"' at position ("+n+")");e.push(u),e.push("^"),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u=""}else if("("===i){if("\0"===a||"("===a||"^"===a||"+"===a||"-"===a||"*"===a||"/"===a||"×"===a||"÷"===a)e.push("("),r.push(pt([n,n+1])),u="";else if("."===a||"!"===a||")"===a||a>="0"&&a<="9")e.push(u),e.push("*"),e.push("("),r.push(pt([n-u.length,n])),r.push(pt([n,n])),r.push(pt([n,n+1])),u="";else{if(!("π"===a||a>="a"&&a<="z"))throw new Error("Invalid lastChar '"+a+"' at position ("+n+")");e.push(u),e.push("("),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u=""}l++}else if(")"===i||"!"===i){if(!("."===a||"!"===a||")"===a||"π"===a||a>="a"&&a<="z"||a>="0"&&a<="9"))throw"\0"===a||"("===a||"^"===a||"+"===a||"-"===a||"*"===a||"/"===a||"×"===a||"÷"===a?new Error("Invalid char '"+i+"' at position ("+n+")"):new Error("Invalid lastChar '"+a+"' at position ("+n+")");if(e.push(u),e.push(i),r.push(pt([n-u.length,n])),r.push(pt([n,n+1])),u="",")"===i&&(l--,l<0))throw new Error("Invalid char ')' at position ("+n+")")}else if(" "!==i)throw new Error("Unknown char '"+i+"' at position ("+n+")");u.length>0&&(e.push(u),r.push(pt([s-u.length,s])));const o=[],h=[];for(s=e.length,n=0;n<s;n++){const t=e[n],i=r[n];if(""!==t){if(t.length>0&&"unary+"!==t&&"unary-"!==t&&"unary+pow"!==t&&"unary-pow"!==t){const e=t[0];if((e<"0"||e>"9")&&"."!==e){const e=t[t.length-1];let r;if(t.length>=6&&("n"===e||"s"===e)&&(r=t.substring(t.length-6),"arcsin"===r||"arccos"===r||"arctan"===r)){const e=Array.prototype.slice.call(t,0,t.length-6).join("*");o.push(...e);for(let t=0;t<e.length;t++)h.push(i);t.length>6&&(o.push("*"),h.push(i)),o.push(r),h.push(i);continue}if(t.length>=4&&("n"===e||"s"===e||"t"===e)&&(r=t.substring(t.length-4),"asin"===r||"acos"===r||"atan"===r||"sqrt"===r)){const e=Array.prototype.slice.call(t,0,t.length-4).join("*");o.push(...e);for(let t=0;t<e.length;t++)h.push(i);t.length>4&&(o.push("*"),h.push(i)),o.push(r),h.push(i);continue}if(t.length>=3&&("n"===e||"s"===e||"g"===e||"p"===e)&&(r=t.substring(t.length-3),"sin"===r||"cos"===r||"tan"===r||"log"===r||"exp"===r)){const e=Array.prototype.slice.call(t,0,t.length-3).join("*");o.push(...e);for(let t=0;t<e.length;t++)h.push(i);t.length>3&&(o.push("*"),h.push(i)),o.push(r),h.push(i);continue}if(t.length>=2&&"n"===e&&(r=t.substring(t.length-2),"ln"===r)){const e=Array.prototype.slice.call(t,0,t.length-2).join("*");o.push(...e);for(let t=0;t<e.length;t++)h.push(i);t.length>2&&(o.push("*"),h.push(i)),o.push(r),h.push(i);continue}const n=Array.prototype.join.call(t,"*");o.push(...n);for(let t=0;t<n.length;t++)h.push(i);continue}}o.push(t),h.push(i)}}if(l>0){const e=pt([t.length,t.length]);for(;l--;)o.push(")"),h.push(e)}return{tokens:o,locations:h}}(t),a=function(t){const e=t.tokens,r=t.locations,n=e.length,i=pt({"!":6,"unary+pow":5,"unary-pow":5,"^":4,"unary+":3,"unary-":3,"*":2,"/":2,"+":1,"-":1}),s=pt(new Set(["ln","log","exp","sqrt","sin","cos","tan","asin","acos","atan","arcsin","arccos","arctan"])),a=pt(new Set(["unary+","unary-","unary+pow","unary-pow","^"])),u=[],l=[];for(let t=0;t<n;t++){const n=e[t],o=r[t];if(s.has(n)||"("===n)l.push(pt([n,o]));else if(")"===n){for(;l.length>0&&"("!==l[l.length-1][0];)u.push(l.pop());if(0===l.length)throw new Error("Mismatched parentheses at position ["+o+"]");l.pop(),l.length>0&&s.has(l[l.length-1][0])&&u.push(l.pop())}else if(i.hasOwnProperty(n)){const t=i[n],e=a.has(n);for(;l.length>0;){const r=l[l.length-1][0];if("("===r||s.has(r))break;const n=i[r]||0;if(!(e?n>t:n>=t))break;u.push(l.pop())}l.push(pt([n,o]))}else u.push(pt([n,o]))}for(;l.length>0;){const t=l.pop();if("("===t[0])throw new Error("Mismatched parentheses at position ["+t[1]+"]");u.push(t)}return u}(s),u=a.length,l=[];for(let t=0;t<u;t++){const s=a[t],u=s[0],o=s[1];if(n.has(u)){if(l.length<2)throw new Error("Insufficient number of parameters for operator '"+u+"' at position ["+o+"]");const t=l.pop(),e=l.pop();try{switch(u){case"+":l.push(bt(e,t));break;case"-":l.push(bt(e,wt(t)));break;case"*":l.push(xt(e,t));break;case"/":l.push(It(e,t));break;case"^":if(0===e.digitsRequired()&&0===t.digitsRequired()){const r=At(e),n=At(t);if(r&&n&&n>=0){l.push(gt(Tt(r,n)));break}}l.push(St(e,t))}}catch(t){throw console.error(t),new Error(t.message+" at position ["+o+"]")}}else if(r.has(u)){if(l.length<1)throw new Error("Insufficient number of parameters for operator '"+u+"' at position ["+o+"]");const t=l.pop();try{switch(u){case"unary+":case"unary+pow":l.push(t);break;case"unary-":case"unary-pow":l.push(wt(t));break;case"!":l.push(dt(t))}}catch(t){throw console.error(t),new Error(t.message+" at position ["+o+"]")}}else if(i.has(u)){if(l.length<1)throw new Error("Insufficient number of parameters for function '"+u+"' at position ["+o+"]");const t=l.pop();try{switch(u){case"ln":l.push(_t(t));break;case"log":l.push(It(_t(t),X));break;case"exp":l.push(St(j,t));break;case"sqrt":l.push(Rt(t));break;case"sin":e?l.push(Nt(xt(t,G))):l.push(Nt(t));break;case"cos":e?l.push(Et(xt(t,G))):l.push(Et(t));break;case"tan":e?l.push(Ct(xt(t,G))):l.push(Ct(t));break;case"asin":case"arcsin":e?l.push(It(Ft(t),G)):l.push(Ft(t));break;case"acos":case"arccos":e?l.push(It(vt(t),G)):l.push(vt(t));break;case"atan":case"arctan":e?l.push(It(yt(t),G)):l.push(yt(t))}}catch(t){throw console.error(t),new Error(t.message+" at position ["+o+"]")}}else{const t=u[0];if("."===t||t>="0"&&t<="9")l.push(mt("."===t?"0"+u:u));else if("e"===u)l.push(j);else{if("π"!==u)throw new Error("Unknown variable '"+u+"' at position ["+o+"]");l.push(z.PI)}}}if(1!=l.length)throw new Error("Invalid stack length: "+l.length);return l.pop()}(e.expr,e.degreeMode);W[e.id]=t;let r=t.digitsRequired(),n=t.exactlyDisplayable();ft({type:"createUR",id:e.id,uid:e.uid,expr:e.expr,degreeMode:e.degreeMode,digitsRequired:r,exactlyDisplayable:n,success:!0})}catch(t){ft({type:"createUR",id:e.id,uid:e.uid,expr:e.expr,degreeMode:e.degreeMode,error:String(t)})}break;case"copyUR":W[e.id]=W[e.fromId];break;case"removeUR":delete W[e.id];break;case"toStringTruncated":try{let t=W[e.id].toStringTruncated(e.prec);ft({type:"toStringTruncated",id:e.id,uid:e.uid,prec:e.prec,result:t})}catch(t){ft({type:"toStringTruncated",id:e.id,uid:e.uid,prec:e.prec,error:String(t)})}break;case"toNiceString":try{let t=W[e.id].toNiceString();ft({type:"toNiceString",id:e.id,uid:e.uid,result:t})}catch(t){ft({type:"toNiceString",id:e.id,uid:e.uid,error:String(t)})}}},ft({type:"init"})})();