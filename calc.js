(()=>{"use strict";const e=2147483647;let t=25,n=0,r=!1,i=!1;const s="*",l=document,c=Math,o=l.getElementById.bind(l),a=c.min,u=c.max,d=c.abs,f=c.floor,v=c.round,g=setInterval,p=clearInterval,h=URL.createObjectURL,L="".replaceAll?(e,t,n)=>e.replaceAll(t,n):(e,t,n)=>e.split(t).join(n),b=o("calculator"),E=o("expression"),m=o("frac_output"),_=o("result_div"),k=o("result_bold"),x=o("result_normal"),y=o("toggle_inv"),T=o("but_eq"),S=o("toggle_mode"),w=o("measure_4ch"),M=[o("num_0"),o("num_1"),o("num_2"),o("num_3"),o("num_4"),o("num_5"),o("num_6"),o("num_7"),o("num_8"),o("num_9")],H=[o("fun_sin"),o("fun_cos"),o("fun_tan"),o("fun_ln"),o("fun_log")],D=[o("fun_arcsin"),o("fun_arccos"),o("fun_arctan"),o("fun_exp"),o("fun_10pow")],O=o("copy_result"),A=o("save_result"),C=o("show_simplify"),R=o("grid_ops"),j=o("grid_var"),N=o("loading");let P,B,U=null,z=!1,W=!1,I=!1,X=!1,q=!1,F=!1,K=!1,G=null,Y="",J=e,Q=32,V=-1,Z=-1,$=0,ee=1,te=1,ne=0;function re(e){let t=l.createElement("input");t.style.opacity="0",t.value=e,l.body.appendChild(t),t.select(),l.execCommand("copy"),t.remove()}function ie(){O.hidden=!X,A.hidden=!X,C.hidden=!(X&&F)}function se(n){if(!z||!X)return;const r=Y.endsWith(".")?Y.length-1:Y.length,i=J!==e&&r<=t;if(K=!i,i)return n?void n(!0,0===J?Y.substring(0,Y.length-1):Y):($=0,0===J?(k.innerHTML=Y.substring(0,Y.length-1),x.innerHTML=""):(k.innerHTML=Y,x.innerHTML=""),void _.classList.remove("result-movable"));-1===Z&&(Z=Y.indexOf("."),-1===Z&&(Z=Y.length));let s=$+t;if(s>r&&(0===J?$=a($,Z-t):J!==e&&($=a($,J+4>=t?Z+1+J-t+String(J).length+2:Z+1+J-t)),s=$+t),$<0&&($=0),_.classList.contains("result-movable")||_.classList.add("result-movable"),s<=Z){let r,i,l,c,o;if(s=a($+t,Y.length),s!==Z||0!==J)for(r=Z-s,i=String(r).length+1,l=r+i,c=String(l),o=c.length+1;o>i;)i=o,l=r+i,c=String(l),o=c.length+1;else c="",o=0;if(0===$){let r=!1;if(o>0&&Z>t){let i="-"===Y[0]?Z-2:Z-1,l=String(i).length+1;if(l<t-3){let t;if(t="-"===Y[0]?Y.substring(0,2)+"."+Y.substring(2,s-l-1)+"E"+i:Y[0]+"."+Y.substring(1,s-l-1)+"E"+i,n)return void(J===e?n(!1,t):n(!0,0===J?Y.substring(0,Y.length-1):Y));k.innerHTML=t,x.innerHTML="",r=!0}}if(!r){if(n)return void(J===e?n(!1,Y.substring(0,s-o)+"E"+c):n(!0,0===J?Y.substring(0,Y.length-1):Y));k.innerHTML=Y.substring($,s-o),x.innerHTML=o>0?"E"+c:""}}else{if(n)return void(J===e?n(!1,Y.substring(0,s-o)+"E"+c):n(!0,0===J?Y.substring(0,Y.length-1):Y));k.innerHTML="..."+Y.substring($+3,s-o),x.innerHTML=o>0?"E"+c:""}}else if(0===$||$+4<=Z){if(s=a($+t,Y.length),n)return void(J===e?n(!1,Y.substring(0,s)):n(!0,0===J?Y.substring(0,Y.length-1):Y));k.innerHTML=0===$?Y.substring($,s):"..."+Y.substring($+3,s),x.innerHTML=""}else{let e=s-Z-1,i=String(e).length+2,l=e-i,c=String(l),o=c.length+2;for(;o<i;)i=o,l=e-i,c=String(l),o=c.length+2;if(o>i&&(l-=1,c=String(l),o=c.length+3),$>r-t+o){if(n)return void n(!1,Y);k.innerHTML="Calculating...",Q=u($-Z+2*o,V+128*a(1024,1+f($/1600))),fe()}else{if(n)return void n(!1,Y.substring(0,s-o));k.innerHTML="..."+Y.substring($+3,s-o)}if(x.innerHTML="E-"+c,$>r-t+o-64){let e=r;Q=V;const n=128*a(1024,1+f($/1600));for(;$>e-t+o-64;)Q+=n,e+=n;Q=a(J,Q),fe()}}}function le(t){const r=t.data;switch(r.type){case"init":if(!z){z=!0;for(let e=0,t=l.getElementsByClassName("intro");e<t.length;e++)t[e].hidden=!0;o("loading-style").remove(),ue(),ge(),navigator.userAgent.indexOf("Firefox")>=0&&(N.innerText="When performing exponentiation and factorial calculations, Chrome/Edge may be faster than Firefox and can compute more digits.",N.hidden=!1)}break;case"createUR":if(r.success)X=!0,F=r.exactlyDisplayable,q=!1,J=r.digitsRequired,Q=J!==e?160:32,V=-1,Z=-1,W=!1,fe();else{X=!1,q=!0,W=!1,T.innerText="=",_.classList.remove("result-movable"),k.innerText=r.error,x.innerHTML="";let e=String(r.error),t=e.match(/at position \[(\d+),(\d+)\]/);if(t){ge();let e=Number(t[1]);E.selectionStart=e,E.selectionEnd=Number(t[2]),E.scrollLeft=n*(e>0?e-1:e)}if(t=e.match(/at position \((\d+)\)/),t){ge();let e=Number(t[1]);E.selectionStart=e,E.selectionEnd=e+1,E.scrollLeft=n*(e>0?e-1:e)}!function(e){e.startsWith("Error: ArithmeticException: ")&&(_.scrollLeft=28*n)}(e),ie()}break;case"toStringTruncated":if(r.uid===te)if(W=!1,T.innerText="=",r.error)X=!1,q=!0,_.classList.remove("result-movable"),k.innerText=r.error,x.innerHTML="",ie();else{X=!0,q=!1;let e=r.result;r.prec>=V&&(V=r.prec,Y=e,se(),ie()),Q>V&&fe()}break;case"toNiceString":if(r.uid===te){const e=r.error||r.result;let n=!1;if(P)try{P.showAlert("Simplified Result",e),n=!0}catch(t){console.error(t)}n||alert("Simplified Result: "+e)}}}function ce(e){console.error(e),N.innerText="Worker Error: "+e.message,N.hidden=!1}function oe(){G&&G.terminate(),G=new Worker(h(new Blob([U],{type:"text/javascript"}))),G.onmessage=le,G.onerror=ce,W=!1,X=!1,q=!1}function ae(e){p(B),N.innerText=e,E.readOnly=!0,E.value=e,_.classList.remove("result-movable"),k.innerHTML="Try refreshing the page.",x.innerHTML="",Array.prototype.forEach.call(b.getElementsByTagName("button"),(e=>{e.disabled=!0}))}function ue(){_.classList.remove("result-movable"),k.innerHTML="",x.innerHTML="",N.hidden=!0,I=!1,X=!1,q=!1,Y="",J=e,Q=32,V=-1,Z=-1,$=0,ie()}function de(){W&&(oe(),T.innerText="="),ue()}function fe(){if(!z||!X||W)return;let e=a(J,Q);e<=V||(W=!0,T.innerText="STOP",G.postMessage({type:"toStringTruncated",id:ee,uid:++te,prec:e}))}function ve(){if(z){if(W)return oe(),void(T.innerText="=");ue(),He(),function(){let e=E.value,t=!1;e.indexOf(" ")>=0&&(e=L(e," ",""),t=!0),e.indexOf("pi")>=0&&(e=L(e,"pi","π"),t=!0),e.indexOf("**")>=0&&(e=L(e,"**","^"),t=!0),e.indexOf("×")>=0&&(e=L(e,"×","*"),t=!0),e.indexOf("÷")>=0&&(e=L(e,"÷","/"),t=!0),t&&(E.value=e,E.selectionStart=E.selectionEnd=e.length)}(),I=!0,T.innerText="STOP",G.postMessage({type:"removeUR",id:ee}),ee=ee+1|0,ie(),G.postMessage({type:"createUR",id:ee,uid:ee,expr:E.value,degreeMode:r}),W=!0}}function ge(){z&&E.focus()}function pe(){y.title=i?"Hide inverse functions":"Show inverse functions"}function he(){S.title=r?"Currently in degree mode":"Currently in radian mode",S.innerHTML=r?"DEG":"RAD"}function Le(e){if(!z)return;const t=E.value,n=E.selectionStart,r=E.selectionEnd;n===r&&n===t.length?E.value=t+e:E.value=t.substring(0,n)+e+t.substring(r,t.length),E.selectionStart=E.selectionEnd=n+e.length,de()}function be(){X&&I&&(I=!1,E.value="",E.selectionStart=0,E.selectionEnd=0)}function Ee(e,t){if(!z)return;be();const n=E.value,r=E.selectionStart;if(r>0){const t=n[r-1];if(")!πxyze".indexOf(t)>=0)return Le(s+e),!0}t||Le(String(e))}function me(e){if(!z)return!0;be();const t=E.value,n=E.selectionStart,r=E.selectionEnd;if(r<t.length){let e=r;for(;e<t.length;){const n=t[e];if("0123456789".indexOf(n)<0){if("."===n)return!0;break}e++}}if(n>0){const e=t[n-1];if(")!πxyze".indexOf(e)>=0)return Le("*0."),!0;if("+-×÷*/^(".indexOf(e)>=0)return Le("0."),!0;{let e=n;for(;e>=0;){e--;const n=t[e];if("0123456789".indexOf(n)<0){if("."===n)return!0;break}}}}if(n<=0)return Le("0."),!0;e||Le(".")}function _e(e,t){if(z){if("("===e){const e=E.value,t=E.selectionStart,n=E.selectionEnd;let r=!1;if(t>0){const n=e[t-1];"0123456789.)!πxyze".indexOf(n)>=0&&(r=!0)}if(t!==n)return r?(E.value=e.substring(0,t)+s+"("+e.substring(t,n)+")"+e.substring(n,e.length),E.selectionStart=t+2,E.selectionEnd=n+2):(E.value=e.substring(0,t)+"("+e.substring(t,n)+")"+e.substring(n,e.length),E.selectionStart=t+1,E.selectionEnd=n+1),de(),!0;if(r)return Le("*("),!0}t||Le(e)}}function ke(e,t){if(!z)return;if("!"===e)return t||Le(e),!1;const n=E.value,r=E.selectionStart;if(r>0){const t=n[r-1];if("-"===e){if("+"===t)E.selectionStart=r-1;else if("-×÷*/^".indexOf(t)>=0)return Le("("+e),!0}else{if("*"===e&&"*"===t)return E.selectionStart=r-1,Le("^"),!0;if(r>0&&"+-×÷*/^".indexOf(t)>=0)return E.selectionStart=r-1,Le(e),!0}}t||Le(e)}function xe(e){if(!z)return;be();const t=E.value,n=E.selectionStart;if(n>0){const r=t.charAt(n-1);if("0123456789.)!πxyze".indexOf(r)>=0)return void Le(s+e)}Le(e)}function ye(e){if(!z)return;be();const t=E.value,n=E.selectionStart;if(n>0){const r=t.charAt(n-1);if("0123456789.)!πxyze".indexOf(r)>=0)return void Le(s+e+"(")}Le(e+"(")}function Te(e){o("fun_"+e).addEventListener("click",(()=>{ye(e),ge()}))}function Se(e){if(!z)return;if(e)return!1;const t=E.selectionStart,n=E.selectionEnd;if(t===n){if(t>0){const e=E.value;E.value=e.substring(0,t-1)+e.substring(n,e.length),E.selectionStart=E.selectionEnd=t-1,de()}}else Le("")}B=g((function(){ne=(ne+1)%4,k.innerHTML="Loading..."+"/-\\|"[ne]}),100),fetch("calc_worker.js").then((e=>{e.ok?e.text().then((e=>{p(B),function(e){U=e,oe()}(e)})).catch((e=>{console.error(e),ae("Error: calc_worker.js "+e)})):ae("Error: calc_worker.js status="+e.status)})).catch((e=>{console.error(e),ae("Error: calc_worker.js "+e)})),pe(),y.addEventListener("click",(function(){if(!z)return;let e;for(i=!i,e=0;e<H.length;e++)i?H[e].classList.add("op-hide"):H[e].classList.remove("op-hide");for(e=0;e<D.length;e++)i?D[e].classList.remove("op-hide"):D[e].classList.add("op-hide");pe(),ge()})),he(),S.addEventListener("click",(function(){z&&(r=!r,he(),X&&ue(),ge())})),M.forEach(((e,t)=>{e.addEventListener("click",(()=>{Ee(t),ge()}))})),o("num_point").addEventListener("click",(()=>{me(),ge()})),o("op_add").addEventListener("click",(()=>{ke("+"),ge()})),o("op_sub").addEventListener("click",(()=>{ke("-"),ge()})),o("op_mul").addEventListener("click",(()=>{ke(s),ge()})),o("op_div").addEventListener("click",(()=>{ke("/"),ge()})),o("op_pow").addEventListener("click",(()=>{ke("^"),ge()})),o("op_fact").addEventListener("click",(()=>{ke("!"),ge()})),o("const_pi").addEventListener("click",(()=>{xe("π"),ge()})),o("const_e").addEventListener("click",(()=>{xe("e"),ge()})),o("op_lparen").addEventListener("click",(()=>{_e("("),ge()})),o("op_rparen").addEventListener("click",(()=>{_e(")"),ge()})),o("op_sqrt").addEventListener("click",(()=>{ye("sqrt"),ge()})),Te("sin"),Te("cos"),Te("tan"),Te("arcsin"),Te("arccos"),Te("arctan"),Te("ln"),Te("log"),Te("exp"),o("fun_10pow").addEventListener("click",(()=>{Le("10^"),ge()})),o("fun_percent").addEventListener("click",(()=>{Le("/100"),ge()})),o("op_cbrt").addEventListener("click",(()=>{Le("^(1/3)"),ge()})),o("but_del").addEventListener("click",(()=>{Se(),ge()})),o("but_clr").addEventListener("click",(()=>{z&&(W&&(oe(),T.innerText="="),E.value="",ue()),ge()})),T.addEventListener("click",ve),E.addEventListener("input",de),E.addEventListener("keydown",(e=>{if(!z)return void e.preventDefault();const t=e.key;switch(t){case"Backspace":Se(!0)&&e.preventDefault();break;case"Enter":case"=":e.preventDefault(),ve();break;case"(":case")":_e(t,!0)&&e.preventDefault();break;case".":me(!0)&&e.preventDefault();break;case"+":case"-":ke(t,!0)&&e.preventDefault();break;case"*":ke(s,!0)&&e.preventDefault();break;case"/":ke("/",!0)&&e.preventDefault();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":Ee(Number(t),!0)&&e.preventDefault()}})),O.addEventListener("click",(()=>{0===J&&0===V?(re(Y.substring(0,Y.length-1)),alert("Exact result has been copied (length:"+(Y.length-1)+")")):J!==e&&V>=J?(re(Y),alert("Exact result has been copied (length:"+Y.length+")")):se(((t,n)=>{re(n),t&&(0===J||J!==e&&V>=J)?alert("Exact result has been copied (length:"+n.length+")"):alert("TRUNCATED result has been copied (length:"+n.length+")")}))})),A.addEventListener("click",(()=>{let t;if(0===J&&0===V?t=Y.substring(0,Y.length-1):J!==e&&V>=J&&(t=Y),t){let e=h(new Blob([t],{type:"text/plain"})),n=l.createElement("a");n.href=e,n.download="output_exact.txt",l.body.appendChild(n),n.click(),n.remove()}else se(((t,n)=>{let r=h(new Blob([n],{type:"text/plain"})),i=l.createElement("a");i.href=r,i.download=t&&(0===J||J!==e&&V>=J)?"output_exact.txt":"output_truncated.txt",l.body.appendChild(i),i.click(),i.remove()}))})),C.addEventListener("click",(()=>{X&&F&&G.postMessage({type:"toNiceString",id:ee,uid:++te})}));{let e=o("but_var");e.disabled=!0,e.innerHTML=""}function we(e){o("var_in_"+e).addEventListener("click",(()=>{})),o("var_out_"+e).addEventListener("click",(()=>{}))}function Me(e){let t=0,n=!1;e.addEventListener("scroll",(()=>{let r=t;t=e.scrollLeft,0!==e.scrollLeft||n||0===r||(e.scrollLeft=r)})),e.addEventListener("focus",(()=>{n=!0,e===E&&(I=!1)})),e.addEventListener("blur",(()=>{n=!1}))}function He(){n=w.getBoundingClientRect().width/4;let e=f(b.clientWidth/n);e!==t&&(t=e,X&&se())}o("but_var").addEventListener("click",(()=>{})),o("var_close").addEventListener("click",(()=>{z&&(R.classList.remove("grid-hide"),j.classList.add("grid-hide"),ge())})),we("x"),we("y"),we("z"),Me(E),Me(m),E.addEventListener("pointerdown",(()=>{I=!1})),new ResizeObserver(He).observe(b),He(),function(){let e=!1,r="",i=0,s=0,l=0,c=0,o=0,a=-1;function f(){let e=d(o);2*e>n&&e!==1/0?o*=.8333333333333334:p(a),i+=o;let t=v(i/n),r=u(0,l-t);r!==$&&($=r,se())}function h(t){z&&X&&K&&(t.preventDefault(),"touchstart"===t.type?i=t.touches[0].screenX:e||(i=t.screenX,_.setPointerCapture(t.pointerId)),r=t.type,p(a),s=i,l=$,c=t.timeStamp,o=0,e=!0,_.focus({preventScroll:!0}))}function L(t){if(e){let e,a;if(t.preventDefault(),"touchmove"===t.type&&"touchstart"===r)e=t.touches[0].screenX;else{if("pointermove"!==t.type||"pointerdown"!==r)return;e=t.screenX}a=e-i;let d=v(a/n),f=t.timeStamp-c;f>=40&&(c=t.timeStamp,o=40*(e-s)/f,s=e);let g=u(0,l-d);g!==$&&($=g,se())}}function b(t){if(e){if("pointerup"===t.type&&"pointerdown"===r)_.releasePointerCapture(t.pointerId);else if("touchstart"!==r||"touchend"!==t.type&&"touchcancel"!==t.type)return;t.preventDefault(),e=!1,i=0,l=$,d(o)>n&&(a=g(f,40))}}const E={passive:!1};_.addEventListener("touchstart",h,E),_.addEventListener("pointerdown",h,E),_.addEventListener("touchmove",L,E),_.addEventListener("pointermove",L,E),_.addEventListener("touchend",b,E),_.addEventListener("pointerup",b,E),_.addEventListener("touchcancel",b,E),_.addEventListener("wheel",(e=>{if(z&&X&&K){p(a),e.preventDefault();let t=e.deltaX+e.deltaY,r=v(t/n),i=u(0,$+r);i!==$&&($=i,se())}})),_.addEventListener("keydown",(e=>{let n;switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),n=u(0,$-(e.ctrlKey?1:4)),n!==$&&($=n,se());break;case"ArrowRight":case"ArrowDown":e.preventDefault(),n=u(0,$+(e.ctrlKey?1:4)),n!==$&&($=n,se());break;case"PageDown":e.preventDefault(),n=u(0,$+t),n!==$&&($=n,se());break;case"PageUp":e.preventDefault(),n=u(0,$-t),n!==$&&($=n,se())}}))}(),fetch("calc_mui.js").then((e=>{e.ok?e.text().then((e=>{Function(e)(),P=window.calcMuiPlugin})).catch((e=>{console.error(e)})):console.error("Error: calc_mui.js status="+e.status)})).catch((e=>{console.error(e)})),onmessage=e=>{"calcMuiPlugin"===e.data&&(P=window.calcMuiPlugin)}})();