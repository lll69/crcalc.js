(()=>{"use strict";const e=2147483647;let t=25,n=0,i=!1,r=!1;const c="*",o=document.getElementById("calculator"),l=document.getElementById("expression"),s=document.getElementById("frac_output"),d=document.getElementById("result_div"),u=document.getElementById("result_bold"),a=document.getElementById("result_normal"),f=document.getElementById("toggle_inv"),m=document.getElementById("but_eq"),g=document.getElementById("toggle_mode"),v=document.getElementById("measure_4ch"),E=[document.getElementById("num_0"),document.getElementById("num_1"),document.getElementById("num_2"),document.getElementById("num_3"),document.getElementById("num_4"),document.getElementById("num_5"),document.getElementById("num_6"),document.getElementById("num_7"),document.getElementById("num_8"),document.getElementById("num_9")],h=[document.getElementById("fun_sin"),document.getElementById("fun_cos"),document.getElementById("fun_tan"),document.getElementById("fun_ln"),document.getElementById("fun_log")],p=[document.getElementById("fun_arcsin"),document.getElementById("fun_arccos"),document.getElementById("fun_arctan"),document.getElementById("fun_exp"),document.getElementById("fun_10pow")],y=document.getElementById("copy_result"),L=document.getElementById("save_result"),b=document.getElementById("grid_ops"),I=document.getElementById("grid_var"),B=document.getElementById("loading");let _,x=null,k=!1,M=!1,T=!1,S=!1,w=!1,H=!1,D=null,O="",R=e,C=32,U=-1,A=-1,j=0,z=1,N=1,P=0;function W(e){let t=document.createElement("input");t.style.opacity="0",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}function X(){y.hidden=!S,L.hidden=!S}function q(n){if(!k||!S)return;const i=O.endsWith(".")?O.length-1:O.length,r=R!==e&&i<=t;if(H=!r,r)return n?void n(!0,0===R?O.substring(0,O.length-1):O):(j=0,0===R?(u.innerHTML=O.substring(0,O.length-1),a.innerHTML=""):(u.innerHTML=O,a.innerHTML=""),void d.classList.remove("result-movable"));-1===A&&(A=O.indexOf("."),-1===A&&(A=O.length));let c=j+t;if(c>i&&(0===R?j=Math.min(j,A-t):R!==e&&(j=R+4>=t?Math.min(j,A+1+R-t+String(R).length+2):Math.min(j,A+1+R-t)),c=j+t),j<0&&(j=0),d.classList.contains("result-movable")||d.classList.add("result-movable"),c<=A){let i,r,o,l,s;if(c=Math.min(j+t,O.length),c!==A||0!==R)for(i=A-c,r=String(i).length+1,o=i+r,l=String(o),s=l.length+1;s>r;)r=s,o=i+r,l=String(o),s=l.length+1;else l="",s=0;if(0===j){let i=!1;if(s>0&&A>t){let r="-"===O[0]?A-2:A-1,o=String(r).length+1;if(o<t-3){let t;if(t="-"===O[0]?O.substring(0,2)+"."+O.substring(2,c-o-1)+"E"+r:O[0]+"."+O.substring(1,c-o-1)+"E"+r,n)return void(R===e?n(!1,t):n(!0,0===R?O.substring(0,O.length-1):O));u.innerHTML=t,a.innerHTML="",i=!0}}if(!i){if(n)return void(R===e?n(!1,O.substring(0,c-s)+"E"+l):n(!0,0===R?O.substring(0,O.length-1):O));u.innerHTML=O.substring(j,c-s),a.innerHTML=s>0?"E"+l:""}}else{if(n)return void(R===e?n(!1,O.substring(0,c-s)+"E"+l):n(!0,0===R?O.substring(0,O.length-1):O));u.innerHTML="..."+O.substring(j+3,c-s),a.innerHTML=s>0?"E"+l:""}}else if(0===j||j+4<=A){if(c=Math.min(j+t,O.length),n)return void(R===e?n(!1,O.substring(0,c)):n(!0,0===R?O.substring(0,O.length-1):O));u.innerHTML=0===j?O.substring(j,c):"..."+O.substring(j+3,c),a.innerHTML=""}else{let e=c-A-1,r=String(e).length+2,o=e-r,l=String(o),s=l.length+2;for(;s<r;)r=s,o=e-r,l=String(o),s=l.length+2;if(s>r&&(o-=1,l=String(o),s=l.length+3),j>i-t+s){if(n)return void n(!1,O);u.innerHTML="Calculating...",C=Math.max(j-A+2*s,U+128*Math.min(1024,1+Math.floor(j/1600))),V()}else{if(n)return void n(!1,O.substring(0,c-s));u.innerHTML="..."+O.substring(j+3,c-s)}if(a.innerHTML="E-"+l,j>i-t+s-64){let e=i;C=U;const n=128*Math.min(1024,1+Math.floor(j/1600));for(;j>e-t+s-64;)C+=n,e+=n;C=Math.min(R,C),V()}}}function F(t){const i=t.data;switch(i.type){case"init":if(!k){k=!0;for(let e=0,t=document.getElementsByClassName("intro");e<t.length;e++)t[e].hidden=!0;document.getElementById("loading-style").remove(),J(),$(),navigator.userAgent.indexOf("Firefox")>=0&&(B.innerText="When performing exponentiation and factorial calculations, Chrome/Edge may be faster than Firefox and can compute more digits.",B.hidden=!1)}break;case"createUR":if(i.success)S=!0,w=!1,R=i.digitsRequired,C=R!==e?160:32,U=-1,A=-1,M=!1,V();else{S=!1,w=!0,M=!1,m.innerText="=",d.classList.remove("result-movable"),u.innerText=i.error,a.innerHTML="";let e=String(i.error),t=e.match(/at position \[(\d+),(\d+)\]/);if(t){$();let e=Number(t[1]);l.selectionStart=e,l.selectionEnd=Number(t[2]),l.scrollLeft=n*(e>0?e-1:e)}if(t=e.match(/at position \((\d+)\)/),t){$();let e=Number(t[1]);l.selectionStart=e,l.selectionEnd=e+1,l.scrollLeft=n*(e>0?e-1:e)}!function(e){e.startsWith("Error: ArithmeticException: ")&&(d.scrollLeft=28*n)}(e),X()}break;case"toStringTruncated":if(i.uid===N)if(M=!1,m.innerText="=",i.error)S=!1,w=!0,d.classList.remove("result-movable"),u.innerText=i.error,a.innerHTML="",X();else{S=!0,w=!1;let e=i.result;i.prec>=U&&(U=i.prec,O=e,q(),X()),C>U&&V()}}}function K(e){console.error(e),B.innerText="Worker Error: "+e.message,B.hidden=!1}function G(){D&&D.terminate(),D=new Worker(URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),D.onmessage=F,D.onerror=K,M=!1,S=!1,w=!1}function Y(e){clearInterval(_),B.innerText=e,l.readOnly=!0,l.value=e,d.classList.remove("result-movable"),u.innerHTML="Try refreshing the page.",a.innerHTML="",Array.prototype.forEach.call(o.getElementsByTagName("button"),(function(e){e.disabled=!0}))}function J(){d.classList.remove("result-movable"),u.innerHTML="",a.innerHTML="",B.hidden=!0,T=!1,S=!1,w=!1,O="",R=e,C=32,U=-1,A=-1,j=0,X()}function Q(){M&&(G(),m.innerText="="),J()}function V(){if(!k||!S||M)return;let e=Math.min(R,C);e<=U||(M=!0,m.innerText="STOP",D.postMessage({type:"toStringTruncated",id:z,uid:++N,prec:e}))}function Z(){if(k){if(M)return G(),void(m.innerText="=");J(),ge(),T=!0,m.innerText="STOP",D.postMessage({type:"removeUR",id:z}),z=z+1|0,X(),D.postMessage({type:"createUR",id:z,uid:z,expr:l.value,degreeMode:i}),M=!0}}function $(){k&&l.focus()}function ee(){f.title=r?"Hide inverse functions":"Show inverse functions"}function te(){g.title=i?"Currently in degree mode":"Currently in radian mode",g.innerHTML=i?"DEG":"RAD"}function ne(e){if(!k)return;const t=l.value,n=l.selectionStart,i=l.selectionEnd;n===i&&n===t.length?l.value=t+e:l.value=t.substring(0,n)+e+t.substring(i,t.length),l.selectionStart=l.selectionEnd=n+e.length,Q()}function ie(){S&&T&&(T=!1,l.value="",l.selectionStart=0,l.selectionEnd=0)}function re(e,t){if(!k)return;ie();const n=l.value,i=l.selectionStart;if(i>0){const t=n[i-1];if(")!πxyze".indexOf(t)>=0)return ne(c+e),!0}t||ne(String(e))}function ce(e){if(!k)return!0;ie();const t=l.value,n=l.selectionStart,i=l.selectionEnd;if(i<t.length){let e=i;for(;e<t.length;){const n=t[e];if("0123456789".indexOf(n)<0){if("."===n)return!0;break}e++}}if(n>0){const e=t[n-1];if(")!πxyze".indexOf(e)>=0)return ne("*0."),!0;if("+-×÷*/^(".indexOf(e)>=0)return ne("0."),!0;{let e=n;for(;e>=0;){e--;const n=t[e];if("0123456789".indexOf(n)<0){if("."===n)return!0;break}}}}if(n<=0)return ne("0."),!0;e||ne(".")}function oe(e,t){if(k){if("("===e){const e=l.value,t=l.selectionStart,n=l.selectionEnd;let i=!1;if(t>0){const n=e[t-1];"0123456789.)!πxyze".indexOf(n)>=0&&(i=!0)}if(t!==n)return i?(l.value=e.substring(0,t)+c+"("+e.substring(t,n)+")"+e.substring(n,e.length),l.selectionStart=t+2,l.selectionEnd=n+2):(l.value=e.substring(0,t)+"("+e.substring(t,n)+")"+e.substring(n,e.length),l.selectionStart=t+1,l.selectionEnd=n+1),Q(),!0;if(i)return ne("*("),!0}t||ne(e)}}function le(e,t){if(!k)return;if("!"===e)return t||ne(e),!1;const n=l.value,i=l.selectionStart;if(i>0){const t=n[i-1];if("-"===e){if("+"===t)l.selectionStart=i-1;else if("-×÷*/^".indexOf(t)>=0)return ne("("+e),!0}else if(i>0&&"+-×÷*/^".indexOf(t)>=0)return l.selectionStart=i-1,ne(e),!0}t||ne(e)}function se(e){if(!k)return;ie();const t=l.value,n=l.selectionStart;if(n>0){const i=t.charAt(n-1);if("0123456789.)!πxyze".indexOf(i)>=0)return void ne(c+e)}ne(e)}function de(e){if(!k)return;ie();const t=l.value,n=l.selectionStart;if(n>0){const i=t.charAt(n-1);if("0123456789.)!πxyze".indexOf(i)>=0)return void ne(c+e+"(")}ne(e+"(")}function ue(e){document.getElementById("fun_"+e).addEventListener("click",(function(){de(e),$()}))}function ae(e){if(!k)return;if(e)return!1;const t=l.selectionStart,n=l.selectionEnd;if(t===n){if(t>0){const e=l.value;l.value=e.substring(0,t-1)+e.substring(n,e.length),l.selectionStart=l.selectionEnd=t-1,Q()}}else ne("")}_=setInterval((function(){P=(P+1)%4,u.innerHTML="Loading..."+"/-\\|"[P]}),100),fetch("calc_worker.js").then((function(e){e.ok?e.text().then((function(e){clearInterval(_),function(e){x=e,G()}(e)})).catch((function(e){console.error(e),Y("Error: calc_worker.js "+e)})):Y("Error: calc_worker.js status="+e.status)})).catch((function(e){console.error(e),Y("Error: calc_worker.js "+e)})),ee(),f.addEventListener("click",(function(){if(!k)return;let e;for(r=!r,e=0;e<h.length;e++)r?h[e].classList.add("op-hide"):h[e].classList.remove("op-hide");for(e=0;e<p.length;e++)r?p[e].classList.remove("op-hide"):p[e].classList.add("op-hide");ee(),$()})),te(),g.addEventListener("click",(function(){k&&(i=!i,te(),S&&J(),$())})),E.forEach((function(e,t){e.addEventListener("click",(function(){re(t),$()}))})),document.getElementById("num_point").addEventListener("click",(function(){ce(),$()})),document.getElementById("op_add").addEventListener("click",(function(){le("+"),$()})),document.getElementById("op_sub").addEventListener("click",(function(){le("-"),$()})),document.getElementById("op_mul").addEventListener("click",(function(){le(c),$()})),document.getElementById("op_div").addEventListener("click",(function(){le("/"),$()})),document.getElementById("op_pow").addEventListener("click",(function(){le("^"),$()})),document.getElementById("op_fact").addEventListener("click",(function(){le("!"),$()})),document.getElementById("const_pi").addEventListener("click",(function(){se("π"),$()})),document.getElementById("const_e").addEventListener("click",(function(){se("e"),$()})),document.getElementById("op_lparen").addEventListener("click",(function(){oe("("),$()})),document.getElementById("op_rparen").addEventListener("click",(function(){oe(")"),$()})),document.getElementById("op_sqrt").addEventListener("click",(function(){de("sqrt"),$()})),ue("sin"),ue("cos"),ue("tan"),ue("arcsin"),ue("arccos"),ue("arctan"),ue("ln"),ue("log"),ue("exp"),document.getElementById("fun_10pow").addEventListener("click",(function(){ne("10^"),$()})),document.getElementById("fun_percent").addEventListener("click",(function(){ne("/100"),$()})),document.getElementById("op_cbrt").addEventListener("click",(function(){ne("^(1/3)"),$()})),document.getElementById("but_del").addEventListener("click",(function(){ae(),$()})),document.getElementById("but_clr").addEventListener("click",(function(){k&&(M&&(G(),m.innerText="="),l.value="",J()),$()})),m.addEventListener("click",Z),l.addEventListener("input",Q),l.addEventListener("keydown",(function(e){if(!k)return void e.preventDefault();const t=e.key;switch(t){case"Backspace":ae(!0)&&e.preventDefault();break;case"Enter":case"=":e.preventDefault(),Z();break;case"(":case")":oe(t,!0)&&e.preventDefault();break;case".":ce(!0)&&e.preventDefault();break;case"+":case"-":le(t,!0)&&e.preventDefault();break;case"*":le(c,!0)&&e.preventDefault();break;case"/":le("/",!0)&&e.preventDefault();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":re(Number(t),!0)&&e.preventDefault()}})),y.addEventListener("click",(function(){0===R&&0===U?(W(O.substring(0,O.length-1)),alert("Exact result has been copied (length:"+(O.length-1)+")")):R!==e&&U>=R?(W(O),alert("Exact result has been copied (length:"+O.length+")")):q((function(t,n){W(n),t&&(0===R||R!==e&&U>=R)?alert("Exact result has been copied (length:"+n.length+")"):alert("TRUNCATED result has been copied (length:"+n.length+")")}))})),L.addEventListener("click",(function(){let t;if(0===R&&0===U?t=O.substring(0,O.length-1):R!==e&&U>=R&&(t=O),t){let e=URL.createObjectURL(new Blob([t],{type:"text/plain"})),n=document.createElement("a");n.href=e,n.download="output_exact.txt",document.body.appendChild(n),n.click(),n.remove()}else q((function(t,n){let i=URL.createObjectURL(new Blob([n],{type:"text/plain"})),r=document.createElement("a");r.href=i,r.download=t&&(0===R||R!==e&&U>=R)?"output_exact.txt":"output_truncated.txt",document.body.appendChild(r),r.click(),r.remove()}))}));{let e=document.getElementById("but_var");e.disabled=!0,e.innerHTML=""}function fe(e){document.getElementById("var_in_"+e).addEventListener("click",(function(){})),document.getElementById("var_out_"+e).addEventListener("click",(function(){}))}function me(e){let t=0,n=!1;e.addEventListener("scroll",(function(){let i=t;t=e.scrollLeft,0!==e.scrollLeft||n||0===i||(e.scrollLeft=i)})),e.addEventListener("focus",(function(){n=!0,e===l&&(T=!1)})),e.addEventListener("blur",(function(){n=!1}))}function ge(){n=v.getBoundingClientRect().width/4;let e=Math.floor(o.clientWidth/n);e!==t&&(t=e,S&&q())}document.getElementById("but_var").addEventListener("click",(function(){})),document.getElementById("var_close").addEventListener("click",(function(){k&&(b.classList.remove("grid-hide"),I.classList.add("grid-hide"),$())})),fe("x"),fe("y"),fe("z"),me(l),me(s),l.addEventListener("pointerdown",(function(){T=!1})),new ResizeObserver(ge).observe(o),ge(),function(){let e=!1,i="",r=0,c=0,o=0,l=0,s=0,u=-1;function a(){let e=Math.abs(s);2*e>n&&e!==1/0?s*=.8333333333333334:clearInterval(u),r+=s;let t=Math.round(r/n),i=Math.max(0,o-t);i!==j&&(j=i,q())}function f(t){k&&S&&H&&(t.preventDefault(),"touchstart"===t.type?r=t.touches[0].screenX:e||(r=t.screenX,d.setPointerCapture(t.pointerId)),i=t.type,clearInterval(u),c=r,o=j,l=t.timeStamp,s=0,e=!0,d.focus({preventScroll:!0}))}function m(t){if(e){let e,d;if(t.preventDefault(),"touchmove"===t.type&&"touchstart"===i)e=t.touches[0].screenX;else{if("pointermove"!==t.type||"pointerdown"!==i)return;e=t.screenX}d=e-r;let u=Math.round(d/n),a=t.timeStamp-l;a>=40&&(l=t.timeStamp,s=40*(e-c)/a,c=e);let f=Math.max(0,o-u);f!==j&&(j=f,q())}}function g(t){if(e){if("pointerup"===t.type&&"pointerdown"===i)d.releasePointerCapture(t.pointerId);else if("touchstart"!==i||"touchend"!==t.type&&"touchcancel"!==t.type)return;t.preventDefault(),e=!1,r=0,o=j,Math.abs(s)>n&&(u=setInterval(a,40))}}d.addEventListener("touchstart",f,{passive:!1}),d.addEventListener("pointerdown",f,{passive:!1}),d.addEventListener("touchmove",m,{passive:!1}),d.addEventListener("pointermove",m,{passive:!1}),d.addEventListener("touchend",g,{passive:!1}),d.addEventListener("pointerup",g,{passive:!1}),d.addEventListener("touchcancel",g,{passive:!1}),d.addEventListener("wheel",(function(e){if(k&&S&&H){clearInterval(u),e.preventDefault();let t=e.deltaX+e.deltaY,i=Math.round(t/n),r=Math.max(0,j+i);r!==j&&(j=r,q())}})),d.addEventListener("keydown",(function(e){let n;switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),n=Math.max(0,j-(e.ctrlKey?1:4)),n!==j&&(j=n,q());break;case"ArrowRight":case"ArrowDown":e.preventDefault(),n=Math.max(0,j+(e.ctrlKey?1:4)),n!==j&&(j=n,q());break;case"PageDown":e.preventDefault(),n=Math.max(0,j+t),n!==j&&(j=n,q());break;case"PageUp":e.preventDefault(),n=Math.max(0,j-t),n!==j&&(j=n,q())}}))}()})();